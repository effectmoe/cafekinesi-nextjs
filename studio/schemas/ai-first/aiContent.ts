import { defineField, defineType } from 'sanity'

// AI-First: AIæœ€é©åŒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
export default defineType({
  name: 'aiContent',
  title: 'AIæœ€é©åŒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ (AI-First)',
  type: 'document',
  icon: () => 'âš ï¸',
  description: 'ğŸ“ ä½¿ç”¨ç®‡æ‰€: ãªã— | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: âš ï¸ æœªå®Ÿè£… | AIæ¤œç´¢æœ€é©åŒ–ç”¨ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆå°†æ¥çš„ãªå®Ÿè£…ã‚’æƒ³å®šï¼‰',

  groups: [
    { name: 'ai', title: 'AIæœ€é©åŒ–' },
    { name: 'basic', title: 'åŸºæœ¬æƒ…å ±' },
    { name: 'relations', title: 'é–¢é€£æƒ…å ±' }
  ],

  fields: [
    // ========== AIæœ€é©åŒ–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ==========
    defineField({
      name: 'aiSearchKeywords',
      title: 'AIæ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰',
      description: 'AIãŒã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ¤œç´¢ã™ã‚‹éš›ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰',
      type: 'array',
      of: [{ type: 'string' }],
      group: 'ai',
      validation: Rule => Rule.required()
    }),

    defineField({
      name: 'aiSummary',
      title: 'AIè¦ç´„',
      description: 'AIãŒå›ç­”ã§ä½¿ç”¨ã™ã‚‹è¦ç´„æ–‡',
      type: 'text',
      group: 'ai',
      validation: Rule => Rule.required().max(300)
    }),

    defineField({
      name: 'aiContext',
      title: 'AIæ–‡è„ˆæƒ…å ±',
      type: 'object',
      group: 'ai',
      fields: [
        {
          name: 'relevantQuestions',
          title: 'é–¢é€£ã™ã‚‹è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³',
          type: 'array',
          of: [{ type: 'string' }]
        },
        {
          name: 'responseHints',
          title: 'AIå›ç­”ã®ãƒ’ãƒ³ãƒˆ',
          type: 'text'
        }
      ]
    }),

    defineField({
      name: 'aiPriority',
      title: 'AIæ¤œç´¢å„ªå…ˆåº¦',
      type: 'number',
      group: 'ai',
      validation: Rule => Rule.min(0).max(10),
      initialValue: 5
    }),

    // ========== åŸºæœ¬æƒ…å ± ==========
    defineField({
      name: 'title',
      title: 'ã‚¿ã‚¤ãƒˆãƒ«',
      type: 'string',
      group: 'basic',
      validation: Rule => Rule.required()
    }),

    defineField({
      name: 'contentType',
      title: 'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—',
      type: 'string',
      group: 'basic',
      options: {
        list: [
          { title: 'ãƒ–ãƒ­ã‚°è¨˜äº‹', value: 'blog' },
          { title: 'ãƒšãƒ¼ã‚¸', value: 'page' },
          { title: 'ãƒ‹ãƒ¥ãƒ¼ã‚¹', value: 'news' },
          { title: 'ã‚¤ãƒ™ãƒ³ãƒˆ', value: 'event' },
          { title: 'FAQ', value: 'faq' }
        ]
      },
      validation: Rule => Rule.required()
    }),

    defineField({
      name: 'extractedContent',
      title: 'æŠ½å‡ºã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„',
      description: 'å…ƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰æŠ½å‡ºãƒ»æœ€é©åŒ–ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ',
      type: 'text',
      group: 'basic'
    }),

    // ========== é–¢é€£æƒ…å ± ==========
    defineField({
      name: 'originalContent',
      title: 'å…ƒã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„',
      description: 'ã“ã®AIæœ€é©åŒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å…ƒã¨ãªã£ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ',
      type: 'reference',
      group: 'relations',
      to: [
        { type: 'blogPost' },
        { type: 'page' },
        { type: 'news' },
        { type: 'event' },
        { type: 'faqCard' }
      ]
    }),

    defineField({
      name: 'relatedServices',
      title: 'é–¢é€£ã‚µãƒ¼ãƒ“ã‚¹',
      type: 'array',
      group: 'relations',
      of: [
        {
          type: 'reference',
          to: [{ type: 'service' }]
        }
      ]
    }),

    defineField({
      name: 'relatedPersons',
      title: 'é–¢é€£äººç‰©',
      type: 'array',
      group: 'relations',
      of: [
        {
          type: 'reference',
          to: [{ type: 'person' }]
        }
      ]
    }),

    // ========== ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ ==========
    defineField({
      name: 'publishedAt',
      title: 'å…¬é–‹æ—¥',
      type: 'datetime',
      group: 'basic'
    }),

    defineField({
      name: 'lastOptimized',
      title: 'æœ€çµ‚æœ€é©åŒ–æ—¥',
      type: 'datetime',
      group: 'ai',
      initialValue: () => new Date().toISOString()
    }),

    defineField({
      name: 'isActive',
      title: 'æœ‰åŠ¹',
      type: 'boolean',
      initialValue: true
    }),

    defineField({
      name: 'autoGenerated',
      title: 'è‡ªå‹•ç”Ÿæˆ',
      description: 'ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒè‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‹ã©ã†ã‹',
      type: 'boolean',
      initialValue: true
    })
  ],

  preview: {
    select: {
      title: 'title',
      contentType: 'contentType',
      priority: 'aiPriority',
      keywords: 'aiSearchKeywords'
    },
    prepare(selection) {
      const { title, contentType, priority, keywords } = selection
      return {
        title,
        subtitle: `${contentType} | å„ªå…ˆåº¦: ${priority} | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${keywords?.slice(0, 3).join(', ') || 'æœªè¨­å®š'}`
      }
    }
  }
})